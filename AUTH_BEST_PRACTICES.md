# Лучшие практики авторизации и аутентификации

## Обзор

В проекте реализованы современные лучшие практики для авторизации и аутентификации, включая:

- Безопасное управление токенами
- Проверка разрешений и ролей
- Управление сессиями
- Валидация паролей
- Автоматический выход при неактивности

## Компоненты

### 1. Страница профиля (`/profile`)

**Функциональность:**
- Просмотр и редактирование личной информации
- Изменение пароля с валидацией
- Настройки уведомлений и темы
- Управление двухфакторной аутентификацией
- Безопасный выход из системы

**Особенности:**
- Проверка аутентификации при загрузке
- Автоматическая загрузка данных пользователя
- Сохранение настроек в localStorage
- Уведомления об успешных операциях

### 2. Модальное окно редактирования профиля

**Функциональность:**
- Редактирование имени, телефона, должности
- Валидация полей в реальном времени
- Email доступен только для чтения
- Обработка ошибок

### 3. Модальное окно изменения пароля

**Функциональность:**
- Ввод текущего пароля
- Создание нового пароля с требованиями
- Подтверждение пароля
- Индикатор силы пароля
- Показ/скрытие паролей

**Требования к паролю:**
- Минимум 8 символов
- Заглавная буква
- Строчная буква
- Цифра
- Специальный символ

## API и Store

### AuthStore

**Новые методы:**
- `validateToken()` - проверка валидности токена
- `refreshToken()` - обновление токена
- `hasPermission(permission)` - проверка разрешения
- `hasRole(role)` - проверка роли
- `isSessionActive()` - проверка активности сессии
- `checkSessionActivity()` - проверка активности сессии

**Безопасность:**
- Автоматическая синхронизация токена с apiClient
- Очистка токена при ошибках
- Валидация токена при каждом запросе

### Composable: usePermissions

**Методы:**
- `hasPermission(permission)` - проверка разрешения
- `hasRole(role)` - проверка роли
- `hasAllPermissions(permissions)` - проверка всех разрешений
- `hasAnyPermission(permissions)` - проверка любого разрешения
- `canAccessModule(module)` - проверка доступа к модулю
- `canPerformAction(module, action)` - проверка действия

**Вычисляемые свойства:**
- `availableModules` - доступные модули
- `isAdmin` - административные права
- `isModerator` - права модератора
- `isOperator` - права оператора

### Composable: useSession

**Функциональность:**
- Отслеживание активности пользователя
- Автоматическое истечение сессии (30 минут)
- Предупреждение о скором истечении (5 минут)
- Периодическая валидация токена
- Принудительный выход при неактивности

**События активности:**
- mousedown, mousemove, keypress
- scroll, touchstart, click

## Использование

### Проверка разрешений в компонентах

```vue
<script setup>
import { usePermissions } from '@/shared/composables/usePermissions'

const { hasPermission, canAccessModule, isAdmin } = usePermissions()

// Проверка разрешения
if (hasPermission('users.create')) {
  // Показать кнопку создания пользователя
}

// Проверка доступа к модулю
if (canAccessModule('users')) {
  // Показать модуль пользователей
}

// Проверка административных прав
if (isAdmin.value) {
  // Показать административные функции
}
</script>
```

### Управление сессией

```vue
<script setup>
import { useSession } from '@/shared/composables/useSession'

const { isSessionActive, sessionWarning, extendSession } = useSession()

// Инициализация сессии
onMounted(async () => {
  await initializeSession()
})

// Продление сессии
const handleExtendSession = async () => {
  await extendSession()
}
</script>
```

### Проверка аутентификации

```vue
<script setup>
import { useAuthStore } from '@/features/auth'

const authStore = useAuthStore()

// Проверка аутентификации
if (!authStore.isAuthenticated) {
  router.push('/')
  return
}

// Загрузка данных пользователя
if (!authStore.user && authStore.token) {
  await authStore.fetchUser()
}
</script>
```

## Безопасность

### Токены
- Автоматическая синхронизация между authStore и apiClient
- Валидация токена при каждом API запросе
- Автоматическая очистка при ошибках 401

### Сессии
- Автоматическое истечение при неактивности
- Предупреждение пользователя о скором истечении
- Периодическая проверка валидности токена

### Пароли
- Строгие требования к сложности
- Валидация в реальном времени
- Безопасная передача через API

### Разрешения
- Проверка на уровне компонентов
- Роль-ориентированный доступ
- Модульная система разрешений

## Рекомендации

1. **Всегда проверяйте аутентификацию** перед загрузкой данных
2. **Используйте composables** для проверки разрешений
3. **Инициализируйте сессию** в корневых компонентах
4. **Обрабатывайте ошибки** аутентификации
5. **Используйте уведомления** для обратной связи с пользователем
6. **Сохраняйте настройки** в localStorage
7. **Валидируйте данные** на клиенте и сервере
